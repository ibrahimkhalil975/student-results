<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ - Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù‡Ø§Ø¯ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {font-family:"Cairo","Tahoma",sans-serif;direction:rtl;background:#f9f9f9;margin:0;padding:0;}
    header {background:#004080;color:#fff;text-align:center;padding:20px;}
    header h1,h2,h3 {margin:5px 0;}
    header h1 {cursor:pointer;transition:0.3s;}
    header h1:hover {color:#ffcc00;}
    main {padding:20px;max-width:800px;margin:auto;}
    input, button {padding:10px;font-size:16px;margin:5px;width:100%;box-sizing:border-box;}
    .card {background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-top:20px;}
    table {width:100%;border-collapse:collapse;margin-top:10px;}
    th, td {border:1px solid #ccc;padding:8px;text-align:center;}
    th {background:#004080;color:#fff;}
    .note {color:red;font-weight:bold;margin-top:10px;}
    .warning {color:#b30000;font-weight:bold;margin-top:15px;text-align:center;}
    footer {
      text-align: center;
      padding: 15px;
      background: #eee;
      margin-top: 20px;
      font-weight: bold;
      font-size: 17px;
      color: #004080;
      font-family: "Courier New", "Cairo", monospace;
    }
    .btn {padding:10px;border:none;border-radius:5px;cursor:pointer;font-size:16px;background:#007bff;color:#fff;}
    .btn:disabled {background:#999;cursor:not-allowed;}
  </style>
</head>
<body>
  <header>
    <h1 onclick="triggerLogout()" title="Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ø¥Ø°Ø§ ÙƒÙ†Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù‡Ø§Ø¯ÙŠ</h1>
    <h2>Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ©</h2>
    <h3>Ù‚Ø³Ù… ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</h3>
  </header>

  <main>
    <h2>ğŸ“‹ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
    <input type="text" id="examInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
    <button id="searchBtn" class="btn" onclick="loadResult()">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

    <div id="resultCard" class="card" style="display:none;">
      <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: <span id="studentName">---</span></p>
      <p>ğŸ†” Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ: <span id="examId">---</span></p>

      <table id="subjectsTableWrapper" style="display:none;">
        <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr></thead>
        <tbody id="subjectsTable"></tbody>
      </table>

      <p class="note">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: <span id="noteText">---</span></p>

      <p id="warningMsg" class="warning" style="display:none;">
        âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯Ø© Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†ØŒ ÙÙ‚Ø· Ù†ØªÙŠØ¬ØªÙƒ
      </p>
    </div>
  </main>

  <footer>
    ğŸ‘¨â€ğŸ’» Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ù„ÙŠÙ„ ÙƒØ§Ù…Ù„
  </footer>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxb8Ok7B_PMbdACBmfrsDzcS9zg64DnnLXtbG4OQcq9zwvQyfyWFfUGsTQoICb6gOe9bg/exec";
    const RESET_CODE = "qbi20";

    window.onload = function() {
      const savedExamId = localStorage.getItem("examId");
      if (savedExamId) {
        document.getElementById("examInput").value = savedExamId;
        loadResult(true);
      }
    };

    function loadResult(fromStorage = false) {
      const examId = document.getElementById("examInput").value.trim();
      if (!examId) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ");

      fetch(`${SCRIPT_URL}?id=${encodeURIComponent(examId)}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("studentName").innerText = data.name || "---";
          document.getElementById("examId").innerText = data.examId || examId;

          const tableBody = document.getElementById("subjectsTable");
          tableBody.innerHTML = "";
          if (!data.subjects || data.subjects.length === 0) {
            document.getElementById("subjectsTableWrapper").style.display = "none";
            document.getElementById("noteText").innerText = data.note || "âš ï¸ ØªÙ… Ø­Ø¬Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚Ø³Ù…";
          } else {
            data.subjects.forEach(sub => {
              if (sub.grade !== "" && sub.grade !== null) {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${sub.name}</td><td>${sub.grade}</td>`;
                tableBody.appendChild(row);
              }
            });
            document.getElementById("subjectsTableWrapper").style.display = "table";
            document.getElementById("noteText").innerText = data.note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø©";
          }

          document.getElementById("resultCard").style.display = "block";
          document.getElementById("examInput").disabled = true;
          document.getElementById("searchBtn").disabled = true;
          document.getElementById("searchBtn").innerText = "ØªÙ… Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬ØªÙƒ";
          document.getElementById("warningMsg").style.display = "block";

          if (!fromStorage) {
            localStorage.setItem("examId", examId);
          }
        })
        .catch(() => alert("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"));
    }

    function triggerLogout() {
      const code = prompt("ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·.\nØ£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ù†Ø¸Ø§Ù…:");
      if (code === RESET_CODE) {
        localStorage.removeItem("examId");
        alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ù†Ø¸Ø§Ù….");
        location.reload();
      } else {
        alert("âš ï¸ Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.");
      }
    }
  </script>
</body>
</html>
