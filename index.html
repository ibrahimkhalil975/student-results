<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <style>
    body {font-family:"Cairo","Tahoma",sans-serif;direction:rtl;background:#f0f0f0;padding:20px;}
    input, button {padding:10px;font-size:16px;margin:5px;}
    .card {background:#fff;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);margin-top:20px;}
    table {width:100%;border-collapse:collapse;margin-top:10px;}
    th, td {border:1px solid #ccc;padding:8px;text-align:center;}
    th {background:#004080;color:#fff;}
    .note {color:red;font-weight:bold;margin-top:10px;}
    .print-btn {background:#28a745;color:#fff;padding:8px 15px;border:none;border-radius:5px;cursor:pointer;margin-top:10px;}
  </style>
</head>
<body>
  <h2>ğŸ“‹ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</h2>
  <input type="text" id="examInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
  <button onclick="loadResult()">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

  <div id="resultCard" class="card" style="display:none;">
    <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: <span id="studentName">---</span></p>
    <p>ğŸ†” Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ: <span id="examId">---</span></p>

    <table id="subjectsTableWrapper" style="display:none;">
      <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr></thead>
      <tbody id="subjectsTable"></tbody>
    </table>

    <p class="note">ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©: <span id="noteText">---</span></p>
    <button class="print-btn" onclick="printResult()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbymzFfjoWi-QuJcW2szRU7ShewRdOcSrD7lzuu5sne7nky13m05AUr_MOM2wi0Q7ojM2g/exec";

    function loadResult() {
      const examId = document.getElementById("examInput").value.trim();
      if (!examId) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ");

      fetch(`${SCRIPT_URL}?id=${encodeURIComponent(examId)}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            const map = {
              missing_id: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ",
              stage_not_found: "Ø§Ù„Ø±Ù‚Ù… Ù„Ø§ ÙŠÙ†ØªÙ…ÙŠ Ù„Ø£ÙŠ Ù…Ø±Ø­Ù„Ø©",
              sheet_not_found: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
              headers_missing: "Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø© (ØªØ­Ù‚Ù‚ Ù…Ù†: Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠØŒ Ø§Ù„Ø§Ø³Ù…ØŒ Ù…Ù„Ø§Ø­Ø¸Ø©/Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ Ø­Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©)",
              not_found: "Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
            };
            alert(map[data.error] || "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙˆØ¶Ø¨Ø· Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.");
            return;
          }

          document.getElementById("studentName").innerText = data.name || "---";
          document.getElementById("examId").innerText = data.examId || examId;

          const tableBody = document.getElementById("subjectsTable");
          tableBody.innerHTML = "";
          if (!data.subjects || data.subjects.length === 0) {
            document.getElementById("subjectsTableWrapper").style.display = "none";
            document.getElementById("noteText").innerText = data.note || "âš ï¸ ØªÙ… Ø­Ø¬Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚Ø³Ù…";
          } else {
            data.subjects.forEach(sub => {
              const row = document.createElement("tr");
              row.innerHTML = `<td>${sub.name}</td><td>${sub.grade}</td>`;
              tableBody.appendChild(row);
            });
            document.getElementById("subjectsTableWrapper").style.display = "table";
            document.getElementById("noteText").innerText = data.note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø©";
          }

          document.getElementById("resultCard").style.display = "block";
        })
        .catch(() => alert("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"));
    }

    function printResult() {
      const printContents = document.getElementById("resultCard").innerHTML;
      const originalContents = document.body.innerHTML;
      document.body.innerHTML = printContents;
      window.print();
      document.body.innerHTML = originalContents;
      location.reload();
    }
  </script>
</body>
</html>
