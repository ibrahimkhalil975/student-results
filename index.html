<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù‡Ø§Ø¯ÙŠ - Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</title>
  <style>
    body {font-family:"Cairo","Tahoma",sans-serif;background:#f0f2f5;direction:rtl;margin:0;padding:0;}
    .header {background:#002147;color:#fff;padding:20px;text-align:center;font-size:26px;font-weight:bold;}
    .sub-header {background:#004080;color:#fff;padding:12px;text-align:center;font-size:18px;}
    .input-section {text-align:center;margin:30px 0;}
    input {padding:10px;width:250px;font-size:16px;border:1px solid #ccc;border-radius:5px;}
    button {padding:10px 20px;font-size:16px;background:#004080;color:#fff;border:none;border-radius:5px;cursor:pointer;margin-right:10px;}
    .card {background:#fff;margin:0 auto 30px;padding:25px;border-radius:12px;box-shadow:0 0 15px rgba(0,0,0,0.1);width:90%;max-width:700px;text-align:right;}
    .student-info {font-size:18px;margin-bottom:20px;border-bottom:2px solid #eee;padding-bottom:10px;}
    table {width:100%;border-collapse:collapse;margin-bottom:20px;}
    th,td {border:1px solid #ccc;padding:10px;text-align:center;}
    th {background:#004080;color:#fff;}
    .note {color:red;font-size:18px;text-align:center;font-weight:bold;margin-bottom:20px;}
    .signature {font-size:16px;color:#555;text-align:left;padding-left:20px;}
    .print-btn {background:#28a745;color:#fff;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;}
  </style>
</head>
<body>
  <div class="header">Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù‡Ø§Ø¯ÙŠ</div>
  <div class="sub-header">Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© - Ù‚Ø³Ù… Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</div>

  <div class="input-section">
    <input type="text" id="examInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…Ùƒ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ">
    <button onclick="loadResult()">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
  </div>

  <div class="card" id="resultCard" style="display:none;">
    <div class="student-info">
      <p>Ø§Ù„Ø§Ø³Ù…: <span id="studentName">---</span></p>
      <p>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ: <span id="examId">---</span></p>
      <p>Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <span id="studentStage">---</span></p>
    </div>

    <table id="subjectsTableWrapper" style="display:none;">
      <thead>
        <tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr>
      </thead>
      <tbody id="subjectsTable"></tbody>
    </table>

    <div class="note">Ù…Ù„Ø§Ø­Ø¸Ø©: <span id="noteText">---</span></div>
    <div class="signature">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø®Ù„ÙŠÙ„</div>
    <div style="text-align:center;margin-top:20px;">
      <button class="print-btn" onclick="printResult()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxqJIRzb3k9btXmVnaR5YntMixsuX69HAms74UaeqzaXpGrqaaJyyxu7QgaxIuTJJ8e6g/exec";

    function loadResult() {
      const examId = document.getElementById("examInput").value.trim();
      if (!examId) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ");

      fetch(`${SCRIPT_URL}?id=${encodeURIComponent(examId)}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            const map = {
              missing_id: "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ÙŠ",
              stage_not_found: "Ø§Ù„Ø±Ù‚Ù… Ù„Ø§ ÙŠÙ†ØªÙ…ÙŠ Ù„Ø£ÙŠ Ù…Ø±Ø­Ù„Ø©",
              sheet_not_found: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙˆØ±Ù‚Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
              empty_sheet: "Ø§Ù„ÙˆØ±Ù‚Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø©",
              headers_missing: "Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ØºÙŠØ± Ù…Ø·Ø§Ø¨Ù‚Ø© (ØªØ­Ù‚Ù‚ Ù…Ù†: Ø±Ù‚Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†ØŒ Ø§Ù„Ø§Ø³Ù…ØŒ Ù…Ù„Ø§Ø­Ø¸Ø©ØŒ Ø­Ø§Ù„Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©)",
              not_found: "Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯"
            };
            alert(map[data.error] || "ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙˆØ¶Ø¨Ø· Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.");
            return;
          }

          document.getElementById("studentName").innerText = data.name || "---";
          document.getElementById("examId").innerText = data.examId || examId;

          // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…
          const num = parseInt(examId, 10);
          let stage = "---";
          if (num >= 455 && num <= 598) stage = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©";
          else if (num >= 33 && num <= 453) stage = "Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©";
          document.getElementById("studentStage").innerText = stage;

          if (!data.subjects || data.subjects.length === 0) {
            document.getElementById("subjectsTableWrapper").style.display = "none";
            document.getElementById("noteText").innerText = data.note || "âš ï¸ ØªÙ… Ø­Ø¬Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø³Ù…ØŒ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù‚Ø³Ù…";
          } else {
            const tableBody = document.getElementById("subjectsTable");
            tableBody.innerHTML = "";
            data.subjects.forEach(sub => {
              const row = document.createElement("tr");
              row.innerHTML = `<td>${sub.name}</td><td>${sub.grade}</td>`;
              tableBody.appendChild(row);
            });
            document.getElementById("subjectsTableWrapper").style.display = "table";
            document.getElementById("noteText").innerText = data.note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø©";
          }

          document.getElementById("resultCard").style.display = "block";
        })
        .catch(() => alert("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙˆØ¶Ø¨Ø· Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª."));
    }

    function printResult() {
      const printContents = document.getElementById("resultCard").innerHTML;
      const originalContents = document.body.innerHTML;
      document.body.innerHTML = printContents;
      window.print();
      document.body.innerHTML = originalContents;
      location.reload();
    }
  </script>
</body>
</html>
