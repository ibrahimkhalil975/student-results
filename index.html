<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>نتائج الطلاب</title>
</head>
<body>
  <h2>أدخل رقمك الامتحاني لعرض النتيجة</h2>
  <input type="text" id="examInput" placeholder="رقم الامتحان">
  <button onclick="loadResult()">عرض النتيجة</button>

  <div id="resultCard" style="display:none;">
    <p>الاسم: <span id="studentName">---</span></p>
    <p>الرقم الامتحاني: <span id="examId">---</span></p>
    <table id="subjectsTableWrapper" style="display:none;">
      <thead><tr><th>المادة</th><th>الدرجة</th></tr></thead>
      <tbody id="subjectsTable"></tbody>
    </table>
    <p>ملاحظة: <span id="noteText">---</span></p>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwJM3PrZ_vexsXzcZH2Ixhn1TzRbTMoNA7p-ZzvfFyVXPFJDN6zMAUfM5p0KzVH9A3K9A/exec";

    function loadResult() {
      const examId = document.getElementById("examInput").value.trim();
      if (!examId) return alert("يرجى إدخال الرقم الامتحاني");

      fetch(`${SCRIPT_URL}?id=${encodeURIComponent(examId)}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            alert("خطأ: " + data.error);
            return;
          }

          document.getElementById("studentName").innerText = data.name || "---";
          document.getElementById("examId").innerText = data.examId || examId;

          if (!data.subjects || data.subjects.length === 0) {
            document.getElementById("subjectsTableWrapper").style.display = "none";
            document.getElementById("noteText").innerText = data.note || "⚠️ تم حجب النتيجة";
          } else {
            const tableBody = document.getElementById("subjectsTable");
            tableBody.innerHTML = "";
            data.subjects.forEach(sub => {
              const row = document.createElement("tr");
              row.innerHTML = `<td>${sub.name}</td><td>${sub.grade}</td>`;
              tableBody.appendChild(row);
            });
            document.getElementById("subjectsTableWrapper").style.display = "table";
            document.getElementById("noteText").innerText = data.note || "لا توجد ملاحظة";
          }

          document.getElementById("resultCard").style.display = "block";
        })
        .catch(() => alert("تعذر جلب البيانات"));
    }
  </script>
</body>
</html>
